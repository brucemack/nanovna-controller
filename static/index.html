<html>
    <head>
        <link rel="stylesheet" href="static/main.css"/>
        <script src="static/jquery-3.5.1.min.js"></script>
        <script src="static/handlebars.min-v4.7.6.js"></script>
        <script src="static/main.js"></script>
        <!-- Handlebars Templates -->
        <script id="template_0" type="text/x-handlebars-template">
            <table>
                <caption>
                    VSWR Sweep Result
                </caption>
                <thead>
                    {{#each headers}}
                    <th>
                        {{this}}
                    </th>
                    {{/each}}
                </thead>
                <tbody>
                    {{#each rows}}
                    <tr>
                        {{#each this.cells}}
                        <td>
                            {{this}}
                        </td>
                        {{/each}}
                    </tr>
                    {{/each}}
                </tbody>
            </table>
        </script>
        <script id="template_1" type="text/x-handlebars-template">
            <table>
                <caption>
                    Complex Sweep Result
                </caption>
                <thead>
                    <td></td>
                    {{#each headers}}
                    <th>
                        {{this}}
                    </th>
                    {{/each}}
                </thead>
                <tbody>
                    {{#each rows}}
                    <tr>
                        <th>{{this.header}}</th>
                        {{#each this.cells}}
                        <td>
                            {{this}}
                        </td>
                        {{/each}}
                    </tr>
                    {{/each}}
                </tbody>
            </table>
        </script>
        <script>
$.ajaxSetup({ cache: false });

var template_0;
var template_1;

$(document).ready(function() {

    // Compile the templates
    template_0 = Handlebars.compile($("#template_0").html());
    template_1 = Handlebars.compile($("#template_1").html());

    setupTabNavigation($(".tabs"))

    // Shut off normal form submit logic
    $(".control-form").submit(function(event) {
        return false
    });

    // Action button on sweep tab
    $("#sweep-tab .go").click(function(event) {
        do_sweep($("#sweep-tab"))
    });
    // Action button on sweep tab
    $("#complex-tab .go").click(function(event) {
        do_complex_sweep($("#complex-tab"))
    });
    // Input on administrative tab
    $("#administration-tab .port-input").blur(function(event) {
        var v = $(this).val()
        $.post("/api/config",{ "port": v })
    });

    // Action buttons on calibration
    $("#calibration-tab .button-0").click(function(event) {
        do_calibration($("#calibration-tab"), 0)
    });
    $("#calibration-tab .button-1").click(function(event) {
        do_calibration($("#calibration-tab"), 1)
    });
    $("#calibration-tab .button-2").click(function(event) {
        do_calibration($("#calibration-tab"), 2)
    });

    // Fill in the initial config values
    $.get("/api/config",function(data) {
        $("#administration-tab .port-input").val(data.port);
    });
});
        </script>
    </head>
    <body>
        <div class="tabs" tabindex="0">
            <div class="tablist" role="tablist" aria-label="Navigation Tabs">
              <button role="tab"
                      aria-selected="true"
                      aria-controls="sweep-tab"
                      id="sweep-control">
                Sweep
              </button>
              <button role="tab"
                      aria-selected="false"
                      aria-controls="complex-tab"
                      id="complex-control"
                      tabindex="-1">
                Complex Sweep
              </button>
              <button role="tab"
                      aria-selected="false"
                      aria-controls="calibration-tab"
                      id="calibration-control"
                      tabindex="-1">
                Calibration
              </button>
              <button role="tab"
                      aria-selected="false"
                      aria-controls="administration-tab"
                      id="administration-control"
                      tabindex="-1">
                Administration
              </button>
              <button role="tab"
                      aria-selected="false"
                      aria-controls="about-tab"
                      id="about-control"
                      tabindex="-1">
                About
              </button>
            </div>

            <!-- ===== VSWR Sweep Panel ================================================== -->
            <div tabindex="0"
                 role="tabpanel"
                 id="sweep-tab"
                 aria-labelledby="sweep-control">
                 <h1>Sweep Panel</h1>
                 <form class="control-form">
                     <label for="s14">Calibration Preset</label>
                     <select class="s4" id="s14" tabindex="0" name="cal_preset">
                         <option>0</option>
                         <option>1</option>
                         <option>2</option>
                         <option>3</option>
                         <option>4</option>
                     </select>
                     <label for="s11">Start Frequency in Megahertz</label>
                     <input class="s1" type="text" id="s11" name="start_frequency_mhz"/>
                     <label for="s12">End Frequency in Megahertz</label>
                     <input class="s2" type="text" id="s12" name="end_frequency_mhz"/>
                     <label for="s13">Step in Megahertz</label>
                     <input class="s3" type="text" id="s13" name="step_frequency_mhz"/>
                     <button class="go">Sweep</button>
                 </form>
                 <div class="result-div"></div>
            </div>

            <!-- ===== Complex VSWR Sweep Panel ============================================= -->
            <div tabindex="0"
                 role="tabpanel"
                 id="complex-tab"
                 aria-labelledby="complex-control"
                 hidden="">
                 <h1>Complex Sweep Panel</h1>
                 <p>The NanoVNA is connected</p>
                 <form class="control-form">
                     <label for="s24">Calibration Preset</label>
                     <select class="s4" id="s24" tabindex="0" name="cal_preset">
                         <option>0</option>
                         <option>1</option>
                         <option>2</option>
                         <option>3</option>
                         <option>4</option>
                     </select>
                     <label for="s21">Start Frequency in Megahertz</label>
                     <input class="s1" type="text" id="s21" name="start_frequency_mhz"/>
                     <label for="s22">End Frequency in Megahertz</label>
                     <input class="s2" type="text" id="s22" name="end_frequency_mhz"/>
                     <label for="s23">Step in Megahertz</label>
                     <input class="s3" type="text" id="s23" name="step_frequency_mhz"/>
                     <button class="go">Sweep</button>
                 </form>
                 <div class="result-div"></div>
            </div>

            <div tabindex="0"
                 role="tabpanel"
                 id="calibration-tab"
                 aria-labelledby="calibration-control"
                 hidden="">
                 <div>
                    <h1>Calibration Panel</h1>
                    <form class="control-form">
                        <label for="s33">Calibration Preset</label>
                        <select class="s4" id="s33" tabindex="0" name="cal_preset">
                            <option>0</option>
                            <option>1</option>
                            <option>2</option>
                            <option>3</option>
                            <option>4</option>
                        </select>
                        <br/>
                        <label for="s31">Start Frequency in Megahertz</label>
                        <input class="s1" tabindex="0" type="text" id="s31" name="start_frequency_mhz"/>
                        <br/>
                        <label for="s32">End Frequency in Megahertz</label>
                        <input class="s2" tabindex="0" type="text" id="s32" name="end_frequency_mhz"/>
                        <br/>
                        <button tabindex="0" class="button-0">Attach Short and Press When Ready</button>
                        <br/>
                        <button tabindex="0" class="button-1">Attach Open and Press When Ready</button>
                        <br/>
                        <button tabindex="0" class="button-2">Attach Load and Press When Ready</button>
                    </form>
                </div>
            </div>
            <div tabindex="0"
                 role="tabpanel"
                 id="administration-tab"
                 aria-labelledby="administration-control"
                 hidden="">
                 <h1>Administration Panel</h1>
                 <label for="s41">Serial Port</label>
                 <input class="port-input" type="text" id="s41" name="serial_port"/>
            </div>
            <div tabindex="0"
                 role="tabpanel"
                 id="about-tab"
                 aria-labelledby="about-control"
                 hidden="">
                 <p>The NanoVNA control panel was designed by N1FMV and KC1FSZ.</p>
                 <p>Details on the NanoVNA can be found <a href="https://nanovna.com/">here</a>.</p>
                 <p>Details on the NanoVNA command language can be found <a href="https://4ham.ru/wp-content/uploads/2020/05/NanoVNA_Console_Commands_Dec-9-19-1.pdf">here</a>.</p>
            </div>
        </div>          
    </body>
</html>